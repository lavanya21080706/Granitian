<!-- src/app/pages/friend-requests/friend-requests.page.html -->
<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Requests</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Segments -->
  <ion-segment [value]="activeSegment" (ionChange)="segmentChanged($event)" class="custom-segment">
    <ion-segment-button value="pending">
      <ion-label>Pending</ion-label>
      <ion-badge color="danger" *ngIf="pendingRequests.length > 0">{{ pendingRequests.length }}</ion-badge>
    </ion-segment-button>
    <ion-segment-button value="accepted">
      <ion-label>Accepted</ion-label>
    </ion-segment-button>
    <ion-segment-button value="sent">
      <ion-label>Sent</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Pending Requests -->
  <div *ngIf="activeSegment === 'pending'" class="segment-content">
    <div class="section-header" *ngIf="pendingRequests.length > 0">
      <ion-label class="section-title">Incoming Requests</ion-label>
    </div>

    <ion-spinner name="crescent" *ngIf="isLoading.pending" class="spinner-center"></ion-spinner>

    <div *ngIf="!isLoading.pending && pendingRequests.length === 0" class="empty-state">
      <ion-icon name="checkmark-circle-outline"></ion-icon>
      <h3>All Clear!</h3>
      <p>No pending friend requests</p>
    </div>

    <ion-list class="request-list" *ngIf="!isLoading.pending && pendingRequests.length > 0">
      <ion-item-sliding *ngFor="let request of pendingRequests" #slidingItem>
        <ion-item class="request-item">
          <ion-avatar slot="start">
            <div class="avatar-placeholder">
              {{ request.sender_name?.charAt(0) || 'U' }}
            </div>
          </ion-avatar>

          <ion-label>
            <h2>{{ request.sender_name || 'Unknown User' }}</h2>
            <p class="username">@{{ request.sender_username || 'username' }}</p>
            <p class="time">{{ getTimeAgo(request.created_at) }}</p>
          </ion-label>

          <div class="request-actions" slot="end">
            <ion-button fill="clear" color="success" (click)="acceptRequest(request); slidingItem.close()">
              <ion-icon name="checkmark-outline" slot="icon-only"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="danger" (click)="rejectRequest(request); slidingItem.close()">
              <ion-icon name="close-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
        </ion-item>
      </ion-item-sliding>
    </ion-list>
  </div>

  <!-- Accepted Requests -->
  <div *ngIf="activeSegment === 'accepted'" class="segment-content">
    <ion-spinner name="crescent" *ngIf="isLoading.accepted" class="spinner-center"></ion-spinner>

    <div *ngIf="!isLoading.accepted && acceptedRequests.length === 0" class="empty-state">
      <ion-icon name="people-outline"></ion-icon>
      <h3>No Connections Yet</h3>
      <p>When you accept requests, they'll appear here</p>
      <ion-button fill="outline" routerLink="/user-search">Find People</ion-button>
    </div>

    <ion-list class="request-list" *ngIf="!isLoading.accepted && acceptedRequests.length > 0">
      <ion-item *ngFor="let request of acceptedRequests">
        <ion-avatar slot="start">
          <div class="avatar-placeholder accepted">
            {{ request.sender_name?.charAt(0) || 'U' }}
          </div>
        </ion-avatar>

        <ion-label>
          <h2>{{ request.sender_name || 'Unknown User' }}</h2>
          <p class="username">@{{ request.sender_username || 'username' }}</p>
          <ion-badge color="success" class="status-badge">Connected</ion-badge>
        </ion-label>

       <ion-button slot="end" fill="clear" routerLink="/messages" [queryParams]="{userId: request.sender_id}">
  <ion-icon name="chatbubble-outline"></ion-icon>
</ion-button>
      </ion-item>
    </ion-list>
  </div>

  <!-- Sent Requests -->
  <div *ngIf="activeSegment === 'sent'" class="segment-content">
    <ion-spinner name="crescent" *ngIf="isLoading.sent" class="spinner-center"></ion-spinner>

    <div *ngIf="!isLoading.sent && sentRequests.length === 0" class="empty-state">
      <ion-icon name="paper-plane-outline"></ion-icon>
      <h3>No Sent Requests</h3>
      <p>Find people and send them connection requests</p>
      <ion-button fill="outline" routerLink="/user-search">Find People</ion-button>
    </div>

    <ion-list class="request-list" *ngIf="!isLoading.sent && sentRequests.length > 0">
      <ion-item-sliding *ngFor="let request of sentRequests" #slidingItem>
        <ion-item class="request-item">
          <ion-avatar slot="start">
            <div class="avatar-placeholder sent">
              {{ request.receiver_name?.charAt(0) || 'U' }}
            </div>
          </ion-avatar>

          <ion-label>
            <h2>{{ request.receiver_name || 'Unknown User' }}</h2>
            <p class="username">@{{ request.receiver_username || 'username' }}</p>
            <p class="time">Sent {{ getTimeAgo(request.created_at) }}</p>
            <ion-badge color="warning" class="status-badge">Pending</ion-badge>
          </ion-label>

          <ion-button slot="end" fill="clear" color="danger" (click)="cancelSentRequest(request); slidingItem.close()">
            <ion-icon name="close-circle-outline"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-item-sliding>
    </ion-list>
  </div>
</ion-content>