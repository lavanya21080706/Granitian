 <app-granitian-header></app-granitian-header>
<!-- <ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Find People</ion-title>
  </ion-toolbar>
</ion-header> -->

<ion-content class="ion-padding">
  <!-- Search Bar -->
  <div class="search-container">
    <div class="custom-input">
      <ion-icon name="search-outline" class="input-icon"></ion-icon>
      <ion-input type="text" placeholder="Search by username (min 3 characters)" [(ngModel)]="searchQuery"
        (ionInput)="onSearchInput()"></ion-input>
      <ion-spinner *ngIf="isLoading" name="crescent" class="search-spinner"></ion-spinner>
    </div>
  </div>

  <!-- Search Results -->
  <div class="results-container" *ngIf="showResults">
    <div class="results-header">
      <ion-label class="results-count">{{ searchResults.length }} users found</ion-label>
    </div>

    <div *ngIf="searchResults.length === 0" class="no-results">
      <ion-icon name="people-outline"></ion-icon>
      <h3>No users found</h3>
      <p>Try searching with a different username</p>
    </div>

    <ion-list class="user-list" *ngIf="searchResults.length > 0">
      <ion-item *ngFor="let user of searchResults" class="user-item">

        <ion-avatar slot="start" class="user-avatar">
          <div class="avatar-placeholder" [ngStyle]="{'background': getAvatarColor(user.user_id)}">
            {{ getInitials(user.first_name + ' ' + user.last_name) }}
          </div>
        </ion-avatar>

        <ion-label>
          <h2>{{ user.first_name }} {{ user.last_name }}</h2>
          <p class="username">@{{ user.user_name }}</p>

          <ion-badge [color]="getUserTypeColor(user.user_type_id)">
            {{ getUserTypeName(user.user_type_id) }}
          </ion-badge>
        </ion-label>

        <!-- RIGHT SIDE ACTION AREA -->
        <div slot="end" class="action-area">

          <!-- Add Button -->
          <!-- <ion-button
      size="small"
      fill="solid"
      color="primary"
      *ngIf="!sentRequests.has(user.user_id) && !user.requestStatus"
      (click)="sendRequest(user.user_id)">
      Add
    </ion-button> -->
          <ion-button class="add-btn" size="small" *ngIf="!sentRequests.has(user.user_id) && !user.requestStatus"
            (click)="sendRequest(user.user_id)">
            <ion-icon name="person-add-outline" slot="start"></ion-icon>
            Add
          </ion-button>


          <!-- Cancel Button -->
          <ion-button class="action-btn cancel-btn" size="small" *ngIf="user.requestStatus === 'PENDING'"
            (click)="cancelRequest(user.requestId, user.user_id)">
            <ion-icon name="close-outline" slot="start"></ion-icon>
            Cancel
          </ion-button>

          <!-- Connected -->
          <div class="action-btn connected-badge" *ngIf="user.requestStatus === 'ACCEPTED'">
            <ion-icon name="checkmark-circle"></ion-icon>
            Connected
          </div>

        </div>

      </ion-item>
    </ion-list>
  </div>

  <!-- Initial State -->
  <div class="initial-state" *ngIf="!showResults">
    <ion-icon name="search-circle-outline"></ion-icon>
    <h3>Find People</h3>
    <p>Search for users by their username to send connection requests</p>
  </div>
</ion-content>